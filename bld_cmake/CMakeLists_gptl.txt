project (gptl
    DESCRIPTION "General Purpose Timing Library modified by CIME developers"
    HOMEPAGE_URL "https://github.com/ESMCI/cime/tree/cime5.6.33/src/share/timing"
    LANGUAGES C Fortran)

add_library(${PROJECT_NAME} STATIC)

find_package(MPI)
if(MPI_FOUND)
    target_compile_definitions(${PROJECT_NAME} PRIVATE HAVE_MPI)
endif()
target_compile_definitions(${PROJECT_NAME} PRIVATE FORTRANUNDERSCORE HAVE_SLASHPROC)

target_sources(${PROJECT_NAME} 
    PRIVATE 
        gptl.h 
        private.h
        gptl.inc 
        f_wrappers.c 
        gptl.c 
        gptl_papi.c 
        GPTLget_memusage.c 
        GPTLprint_memusage.c 
        GPTLutil.c
    PUBLIC 
        perf_mod.F90
        perf_utils.F90
    )
install (TARGETS ${PROJECT_NAME} ARCHIVE DESTINATION ${CMAKE_INSTALL_LIBDIR})